function handleBodyKeyDown(n){var t=angular.element("#datacontroller").scope(),i=angular.element("#itemcontroller").scope();if(n.srcElement.tagName==="BODY")switch(n.keyCode){case 34:case 39:case 40:case 74:t.$apply(t.selectNextItem());break;case 32:n.preventDefault();break;case 33:case 37:case 38:case 75:t.$apply(t.selectPreviousItem());break;case 85:i.$apply(i.toggleRead());break;case 72:i.$apply(i.toggleStar())}}document.addEventListener("keydown",handleBodyKeyDown,!1),appEvents={ITEM_SELECTED:"itemselected"},angular.module("feedReader",["ngResource"]).factory("feed",["$resource",function(n){var r=encodeURIComponent("http://blog.chromium.org/feeds/posts/default?alt=rss"),t="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'",i;return t+=r+"'&format=json&callback=JSON_CALLBACK",i=n(t,{},{get:{method:"JSONP"}})}]),angular.module("persistance",[]).service("store",function(){var u=this,t=!1,i=new Lawnchair({name:"entries",record:"entry"},function(){t=!0}),n,r;this.all=function(n){i.all(n)},this.save=function(n){i.save(n)},this.ready=function(n){r(function(){return t},n)},n=function(n){setTimeout(n,1e3)},r=function(t,i){n(function(){t()?i():n(arguments.callee)})}});var myMain=angular.module("main",["feedReader","persistance"]),WReader={};WReader.Item=function(){this.read=!1,this.starred=!1,this.item_id=null,this.title=null,this.pub_name=null,this.pub_author=null,this.pub_date=new Date(0),this.short_desc=null,this.content=null,this.feed_link=null,this.item_link=null},myMain.controller("DataController",["$scope","feed","store",function(n,t,i){var r=function(){return!0},e=function(n){return n.read===!1},u=function(n){return n.read===!0},s=function(n){return n.starred===!0},f,o;n.content=[],n.selectedItem=null,f=function(n){t.get(function(t){var i=t.query.results.rss.channel.item,r=t.query.results.rss.channel.link,u=i.map(function(n){var i={};return i.item_id=n.guid.content,i.pub_name=t.query.results.rss.channel.title,i.pub_author=n.author,i.title=n.title,n.origLink?i.item_link=n.origLink:n.link&&(i.item_link=n.link),i.feed_link=r,i.content=n.description,n.description&&(i.short_desc=n.description.substr(0,128)+"..."),i.pub_date=new Date(n.pubDate),i.read=!1,i.key=i.item_id,i});n(u)})},n.markAllRead=function(){$.each(n.content,function(n,t){t.read=!0})},n.addItem=function(t){var u=this.content.filter(function(n){return n.item_id===t.item_id}).length,i,r;return u===0?(i=n.content.length,r=n.binarySearch(Date.parse(t.pub_date),0,i,n.content),n.content.splice(r,0,t),!0):!1},n.selectItem=function(t){n.selectedItem=t,n.selectedItem.read=!0,amplify.publish(appEvents.ITEM_SELECTED,{itemSelected:t,itemIndex:this.selectedItemIndex(),itemCount:this.filteredItemsCount()})},n.selectNextItem=function(){var t=n.selectedItemIndex()+1,i=n.filteredItems(),r;t<0||t>=i.length||(r=i[t],n.selectItem(r))},n.selectPreviousItem=function(){var t=n.selectedItemIndex()-1,i=n.filteredItems(),r;t<0||t>=i.length||(r=i[t],n.selectItem(r))},n.itemSelected=function(){return this.selectedItem===null?!1:!0},n.refresh=function(){f(function(t){n.content=t,n.currentFilter=r})},n.currentFilter=r,n.filterAll=function(){this.currentFilter=r,this.selectedItem=null,amplify.publish(appEvents.ITEM_SELECTED,{itemSelected:this.selectedItem,itemIndex:this.selectedItemIndex(),itemCount:this.filteredItemsCount()})},n.filterUnread=function(){this.currentFilter=e,this.selectedItem=null,amplify.publish(appEvents.ITEM_SELECTED,{itemSelected:this.selectedItem,itemIndex:this.selectedItemIndex(),itemCount:this.filteredItemsCount()})},n.filterRead=function(){this.currentFilter=u,this.selectedItem=null,amplify.publish(appEvents.ITEM_SELECTED,{itemSelected:this.selectedItem,itemIndex:this.selectedItemIndex(),itemCount:this.filteredItemsCount()})},n.filterStarred=function(){this.currentFilter=u,this.selectedItem=null,amplify.publish(appEvents.ITEM_SELECTED,{itemSelected:this.selectedItem,itemIndex:this.selectedItemIndex(),itemCount:this.filteredItemsCount()})},n.readCount=function(){return this.content.filter(u).length},n.itemCount=function(){return this.content.filter(r).length},n.unreadCount=function(){return this.content.filter(e).length},n.starredCount=function(){return this.content.filter(s).length},n.filteredItemsCount=function(){return this.content.filter(this.currentFilter).length},n.filteredItems=function(){return this.content.filter(this.currentFilter)},n.selectedItemIndex=function(){return $.inArray(this.selectedItem,this.filteredItems())},n.formattedDate=function(n){return moment(n.pub_date).fromNow()},n.binarySearch=function(n,t,i,r){var u,f;return t===i?t:(u=t+Math.floor((i-t)/2),f=Date.parse(r[u].pub_date),n<f)?this.binarySearch(n,u+1,i,r):n>f?this.binarySearch(n,t,u,r):u},o=function(){i.ready(function(){i.all(function(t){t.forEach(function(t){n.addItem(t)}),f(function(t){t.forEach(function(t){n.addItem(t)&&i.save(t)}),n.currentFilter=r})})})},o()}]),myMain.controller("ItemController",["$scope",function(n){var t=function(t){n.item=t.itemSelected,n.itemIndex=t.itemIndex,n.itemCount=t.itemCount};amplify.subscribe(appEvents.ITEM_SELECTED,n,t),n.toggleRead=function(){this.item!==undefined&&(this.item.read=!this.item.read)},n.toggleStar=function(){this.item!==undefined&&(this.item.starred=!this.item.starred)}}]),myMain.controller("NavControlsController",["$scope",function(n){n.item=null,n.itemIndex=-1,n.itemCount=0;var t=function(t){n.item=t.itemSelected,n.itemIndex=t.itemIndex,n.itemCount=t.itemCount};amplify.subscribe(appEvents.ITEM_SELECTED,n,t),n.toggleStar=function(){this.item!==undefined&&(this.item.starred=!this.item.starred)},n.toggleRead=function(){this.item!==undefined&&(this.item.read=!this.item.read)},n.itemSelected=function(){return this.item===null?!1:!0},n.canGotoNext=function(){return this.itemIndex<this.itemCount-1&&this.itemCount>0&&this.itemSelected()},n.canGotoPrevious=function(){return this.itemIndex>0&&this.itemCount>0&&this.itemSelected()}}])